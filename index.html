<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <style>
        .container {
            width: 500px;
            padding: 20px;
            background: #e3e3e3;
        }

        img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .table {
            margin-bottom: 20px;
        }

        .table__header {
            background: tomato;
        }

        .table__row {
            display: flex;
            justify-content: space-between;
        }

        .page {
            padding: 10px;
            margin-bottom: 20px;
            background: #bada55;
        }
    </style>
</head>
<body>
    <div class="body body--columnTable">
        <div class="column column--columnTable js-contents-container-target"></div> <!-- column -->
    </div> <!-- body -->

    <div class="page" data-page-heading="Page 1" data-page-contents="true" data-page-group="review">
        <div class="pageNumber"></div>
    </div>
    <div class="page" data-page-heading="Page 2" data-page-contents="true" data-page-group="review">
        <div class="pageNumber"></div>
    </div>
    <div class="page" data-page-heading="Page 3" data-page-contents="true" data-page-group="test">
        <div class="pageNumber"></div>
    </div>

    <div class="page" data-page-heading="Page For the third group" data-page-contents="true" data-page-group="third">
        <div class="pageNumber"></div>
    </div>

    <div class="page" data-page-heading="Page 3a" data-page-contents="false" data-page-group="test">
        <div class="pageNumber"></div>
    </div>
    <div class="page" data-page-heading="Page Review" data-page-contents="true" data-page-group="review">
        <div class="pageNumber"></div>Bla
    </div>
    <div class="page" data-page-heading="Page 4" data-page-contents="true" data-page-group="test">
        <div class="pageNumber"></div>
    </div>
    <div class="page" data-page-heading="Page 5" data-page-contents="true" data-page-group="test">
        <div class="pageNumber"></div>
    </div>
    <div class="page" data-page-heading="Page 5" data-page-contents="true" data-page-group="review">
        <div class="pageNumber"></div>
    </div>

<script>
function injectContents() {
    const pages = [...document.querySelectorAll('[data-page-heading]')];
    const contentContainer = document.querySelector('.js-contents-container-target');
    let groups = [];

    addPageNums();

    pages.forEach((page, i) => {
        const pageNum = page.dataset.pageNumber;
        const pageGroup = page.dataset.pageGroup;

        // Checking if the page is missing heading or it's data-page-contents is set to false
        if ( page.dataset.pageHeading == '' || page.dataset.pageContents == 'false' ) return;

        // Checking if this is the first iteration or table for the current page's group doesn't already exist
        if ( i == 0 || !groups.includes(pageGroup) ) {
            const table = document.createElement('div');
            table.classList.add('table');
            table.setAttribute('id', pageGroup);

            const header = document.createElement('div');
            header.classList.add('table__row', 'table__header');
            header.innerText = pageGroup;
            table.appendChild(header);
            contentContainer.appendChild(table);
        }

        const row = document.createElement('div');
        row.classList.add('table__row');

        const label = document.createElement('div');
        label.classList.add('table__label');
        label.innerText = page.dataset.pageHeading;
        row.appendChild(label);

        const value = document.createElement('div');
        value.classList.add('table__value');
        value.innerText = pageNum;
        row.appendChild(value);

        document.querySelector(`#${pageGroup}`).appendChild(row);

        if ( !groups.includes(pageGroup) ) groups.push(pageGroup);
    });
}

function addPageNums() {
    const pages = document.querySelectorAll('.page');
    pages.forEach((page, index) => {
        const pageNumDiv = page.querySelector('.pageNumber');

        if ( pageNumDiv == null ) return;

        if ( index % 2 ) pageNumDiv.classList.add('pageNumber--right');

        page.dataset.pageNumber = index;
        pageNumDiv.innerHTML = index;
    });
}

injectContents();
</script>

</body>
</html>